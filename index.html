<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login â€¢ OwnFleet</title>
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const SUPABASE_URL = "https://bzbkqvxixxkcmfrhtcxq.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6YmtxdnhpeHhrY21mcmh0Y3hxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMzI2MzUsImV4cCI6MjA3NjcwODYzNX0.TNKG7NIx7HHSTcfU2IYiba9zV0zaPYvhGSImA62LebE";
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function baseUrl() {
  const { origin, pathname } = window.location;
  const dir = pathname.endsWith("/") ? pathname : pathname.replace(/[^/]*$/, "");
  return origin + dir;
}

document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("login-btn");
  const msg = document.getElementById("msg");

  btn.addEventListener("click", async () => {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: "google",
      options: {
        redirectTo: baseUrl() + "index.html",
        queryParams: { prompt: "select_account" }
      }
    });
    if (error) msg.textContent = error.message;
  });

  supabase.auth.onAuthStateChange(async (_evt, session) => {
    const user = session?.user;
    if (!user) return;
    await supabase.from("usuarios_motoristas").upsert({ owner: user.id, email: user.email || null });
    window.location.href = baseUrl() + "cadastro.html";
  });
});
</script>
<style>
body {
  display: flex; align-items: center; justify-content: center;
  height: 100vh; background: #fafafa; font-family: "Poppins", sans-serif;
}
.card {
  text-align: center; background: white; padding: 40px; border-radius: 18px;
  box-shadow: 0 8px 30px rgba(0,0,0,.08);
}
button {
  background: #ff5a2a; color: white; border: none; padding: 12px 28px;
  border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;
}
button:hover { background: #ff713f; }
#msg { color: #d00; margin-top: 10px; font-size: 14px; }
</style>
</head>
<body>
  <div class="card">
    <h2>Entrar com Google</h2>
    <button id="login-btn">Login com Google</button>
    <p id="msg"></p>
  </div>
</body>
</html>
