<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OwnFleet ‚Ä¢ Cadastro de Regi√µes</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
:root{
  --brand:#ee4d2d;
  --brand-2:#ff6b3d;
  --ink:#1f2937;
  --card:rgba(255,255,255,.95);
  --shadow:0 18px 48px rgba(238,77,45,.25);
}
body{
  display:flex;align-items:center;justify-content:center;
  min-height:100vh;margin:0;
  font-family:'Poppins',system-ui,sans-serif;
  background:linear-gradient(145deg,var(--brand),var(--brand-2));
}
.card{
  background:var(--card);border-radius:22px;
  box-shadow:var(--shadow);
  max-width:380px;width:90%;
  text-align:center;padding:2rem 1.6rem;
  backdrop-filter:blur(12px);
}
.logo{
  width:88px;height:88px;
  margin-bottom:1rem;
  border-radius:24px;
  background:linear-gradient(145deg,#fff3ef,#fff);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 6px 18px rgba(238,77,45,.25);
}
.logo i{font-size:2.5rem;color:var(--brand);}
h1{
  margin:.3rem 0;font-weight:800;
  color:var(--brand);
  font-size:1.6rem;
}
p.desc{
  color:#555;font-size:.96rem;line-height:1.45;
  margin:0 0 1.6rem;
}
.btn{
  background:var(--brand);color:#fff;
  border:0;border-radius:10px;
  padding:13px 22px;
  font-weight:700;font-size:1rem;
  cursor:pointer;transition:.2s;
  width:100%;
  display:flex;align-items:center;justify-content:center;gap:.6rem;
}
.btn:hover{background:var(--brand-2);transform:translateY(-2px);}
.small{color:#444;margin-top:14px;font-size:.85rem;}
.err{color:#b00020;margin-top:10px;white-space:pre-wrap;}
footer{
  text-align:center;
  color:rgba(255,255,255,.9);
  font-size:.8rem;
  margin-top:1rem;
}
footer a{color:#fff;text-decoration:none;font-weight:500;}
footer a:hover{text-decoration:underline;}
</style>
</head>

<body>
  <div class="card">
    <div class="logo"><i class="fa-solid fa-map-location-dot"></i></div>
    <h1>OwnFleet</h1>
    <p class="desc">
      Sistema de <b>Cadastro de Regi√µes</b> para motoristas e conferentes.  
      Fa√ßa login com o Google para acessar sua conta e registrar as regi√µes que voc√™ atende.
    </p>

    <button id="login-btn" class="btn">
      <i class="fa-brands fa-google"></i> Entrar com Google
    </button>
    <div id="msg" class="small"></div>
  </div>

  <footer>¬© 2025 OwnFleet ‚Ä¢ Log√≠stica Inteligente</footer>

<!-- üîπ Supabase SDK -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const SUPABASE_URL = "https://bzbkqvxixxkcmfrhtcxq.supabase.co";
const SUPABASE_ANON_KEY =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6YmtxdnhpeHhrY21mcmh0Y3hxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMzI2MzUsImV4cCI6MjA3NjcwODYzNX0.TNKG7NIx7HHSTcfU2IYiba9zV0zaPYvhGSImA62LebE";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const btn = document.getElementById("login-btn");
const msg = document.getElementById("msg");

document.addEventListener("DOMContentLoaded", async () => {
  const { data:{ user } } = await supabase.auth.getUser();
  if(user){
    await supabase.from("usuarios_motoristas").upsert({ owner:user.id, email:user.email||null });
    location.href="https://ownfleet.github.io/atualiza-odedados/cadastro.html";
    return;
  }

  btn.onclick = async () => {
    msg.textContent = "Abrindo Google...";
    const { error } = await supabase.auth.signInWithOAuth({
      provider: "google",
      options: {
        redirectTo: "https://ownfleet.github.io/atualiza-odedados/cadastro.html",
        scopes: "openid profile email",
        queryParams: { prompt: "select_account" }
      }
    });
    if (error) {
      msg.className = "err";
      msg.textContent = "Erro: " + error.message;
    }
  };

  supabase.auth.onAuthStateChange(async (_evt, session) => {
    if (session?.user) {
      await supabase.from("usuarios_motoristas").upsert({
        owner: session.user.id,
        email: session.user.email || null
      });
      location.href = "https://ownfleet.github.io/atualiza-odedados/cadastro.html";
    }
  });
});
</script>
</body>
</html>
