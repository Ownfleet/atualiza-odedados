<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Entrar ‚Ä¢ OwnFleet</title>
<style>
  :root { --brand:#ff5a2a; }
  body {
    display:grid;place-items:center;min-height:100vh;
    background:#f6f7fb;font-family:Poppins,system-ui,Arial;margin:0;
  }
  .card {
    background:#fff;padding:36px;border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    text-align:center;max-width:480px;width:92%;
  }
  h2 { margin:0 0 10px;font-weight:800;color:#111; }
  .btn {
    background:var(--brand);color:#fff;border:0;border-radius:10px;
    padding:12px 22px;font-weight:700;cursor:pointer;transition:.2s;
  }
  .btn:hover { background:#ff6c43;transform:translateY(-2px); }
  .small { color:#555;margin-top:10px; }
  .err { color:#b00020;margin-top:10px;white-space:pre-wrap; }
</style>
</head>

<body>
  <div class="card">
    <h2>Entrar com Google</h2>
    <p class="small">Voc√™ ser√° redirecionado pelo Google e voltar√° para o cadastro.</p>
    <button id="login-btn" class="btn">Login com Google</button>
    <div id="msg" class="small"></div>
  </div>

<!-- üîπ SDK via ESM (garante que o createClient existe) -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const SUPABASE_URL = "https://bzbkqvxixxkcmfrhtcxq.supabase.co";
const SUPABASE_ANON_KEY =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6YmtxdnhpeHhrY21mcmh0Y3hxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMzI2MzUsImV4cCI6MjA3NjcwODYzNX0.TNKG7NIx7HHSTcfU2IYiba9zV0zaPYvhGSImA62LebE";
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// DOM
const btn = document.getElementById("login-btn");
const msg = document.getElementById("msg");

document.addEventListener("DOMContentLoaded", async () => {
  // üîπ Verifica se j√° h√° sess√£o
  const { data:{ user } } = await supabase.auth.getUser();
  if(user){
    await supabase.from("usuarios_motoristas").upsert({ owner:user.id, email:user.email||null });
    location.href="https://ownfleet.github.io/atualiza-odedados/cadastro.html";
    return;
  }

  // üîπ Clique no bot√£o
  btn.onclick = async () => {
    msg.textContent = "Abrindo Google...";
    const { error } = await supabase.auth.signInWithOAuth({
      provider: "google",
      options: {
        redirectTo: "https://ownfleet.github.io/atualiza-odedados/cadastro.html",
        queryParams: { prompt: "select_account" }
      }
    });
    if (error) {
      msg.className = "err";
      msg.textContent = "Erro: " + error.message;
    }
  };

  // üîπ Listener de sess√£o
  supabase.auth.onAuthStateChange(async (_evt, session) => {
    if (session?.user) {
      await supabase.from("usuarios_motoristas").upsert({
        owner: session.user.id,
        email: session.user.email || null
      });
      location.href = "https://ownfleet.github.io/atualiza-odedados/cadastro.html";
    }
  });
});
</script>
</body>
</html>
